name: CI/CD
on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: ubuntu-latest
    # CRITICAL: Grant permission to write to GitHub Packages
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy with Dagger
        uses: dagger/dagger-for-github@v7
        with:
          verb: call
          args: >
            deploy 
            --source=. 
            --registry-addr=ghcr.io 
            --username=${{ github.actor }} 
            --password=env:GITHUB_TOKEN
        env:
          # Use the automatic GitHub token provided by the runner
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
