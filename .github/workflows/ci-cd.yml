name: CI/CD
on:
  push:
    branches: [master] # Make sure this matches your default branch (main or master)

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy with Dagger
        uses: dagger/dagger-for-github@v7
        with:
          version: '0.19.10'
          verb: call
          args: deploy-to-server --source=. --registry-addr=ghcr.io --username=${{ github.actor }} --password=env:GITHUB_TOKEN --ssh-host=env:SSH_HOST --ssh-user=env:SSH_USER --ssh-key=env:SSH_KEY --ssh-port=env:SSH_PORT
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SSH_HOST: ${{ secrets.SSH_HOST }}
          SSH_USER: ${{ secrets.SSH_USER }}
          SSH_KEY: ${{ secrets.SSH_KEY }}
          SSH_PORT: ${{ secrets.SSH_PORT }}
