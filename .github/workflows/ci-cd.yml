name: CI/CD
on:
  push:
    branches: [master] # Make sure this matches your default branch (main or master)

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy with Dagger
        uses: dagger/dagger-for-github@v7
        with:
          verb: call
          # Use | to preserve formatting exactly as written
          args: |
            deploy 
            --source=. 
            --registry-addr=ghcr.io 
            --username=${{ github.actor }} 
            --password=env:GITHUB_TOKEN
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
